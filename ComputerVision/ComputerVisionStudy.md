# Computer Vision

---
## Chapter 2

### 샘플링과 양자화

* 2차원 영상 공간을 M*N으로 샘플링 = M*N 해상도라 부름
* 영상좌표계는 화소위치를 x=(j,i) 또는 x = (y,x)라고 부른다. 원점이 왼쪽 위에 위치

### 히스토그램

* 명암값이 나타난 빈도수로 [0,L-1] 사이의 명암값 각각이 영상에 몇 번 나타나는지 표시
* 정규 히스토그램 = 분모를 M*N로 나누어 모든 칸의 합이 1이 되도록

### 평활화

* 영상을 선명하게 만들어줌

### 역투영

* 물체의 모양은 무시하고 단순히 컬러 분포만으로 검출하는 방법

### 이진영상

* 영상이 흑 , 백만 존재. 명암 영상을 임계값 사용하여 검출
* 오츄 알고리즘
  * 임계값을 t를 기준으로 화소를 두 집합으로 나누었을 때, 각 집합의 명암 분퐉 균일할수록 좋다는 점에 착인
  * 균일성은 그룹의 분산을 측정하는데, 분산이 작을수록 균일성이 높다.

### 연결요소

* 4-연결성, 8-연결성
* 연결요소를 찾아 번호를 붙이려면 범람채움 알고리즘을 사용

### 영상 처리의 세 가지 기본 연산

- 점 연산 - 밝거나 어둡게 , 반전시키기, 감마 연산

- 영역 연산 - 상관과 컨볼루션

  - 상관 - 윈도우u 와 영상 f가 얼마나 비슷한지 측정해주는 연산
  - 컨볼루션 - 윈도우를 적용하기 전에 뒤집는 것만 빼고 상관과 같다.
  - 윈도우 = 커널, 마스크, 필터, 템플릿
  - 다양한 마스크 종류 = 박스, 카우시안, 샤프닝, 수평 에지, 수직 에지, 모션
  - 비선형 연산 - 컨볼루션은 선형연산이다. 
    - 솔트페퍼, 가우시안, 메디안 필터

- 기하 연산 - 이동, 회전, 크기, 기울임

- **보간** - 알려진 값 사이에 위치한 값을 추정.
- 사람이 20살일때 키와 40살에서의 키를 보고 30살에서의 키를 추측 -> interpolation
  - x1값을 고 x2값을 알때, x3의 값을 추축 ->extrapolation
  - 선형 보간법 - 두 점의 값이 주어졌을 때 그 사이에 위치한 값을 추정하기 위하여 직선 거리에 따라 선형적으로 계산.
  - 1차원에서의 선형 보간법을 2차원으로 확장. 최대 이웃 보간에 비하여 더 스무딩한 영상 출력가능.
  - 선형보간을 x축과 y축으로 두 번 적용하여 값을 유추하는 방법.

![IMG_23CB214598A9-1](https://user-images.githubusercontent.com/46750574/73656697-0dfe4480-46d4-11ea-957b-bdb04523f648.jpeg)

![IMG_0F0B2B7B57D1-1](https://user-images.githubusercontent.com/46750574/73656695-0d65ae00-46d4-11ea-87b4-3f49a61114ca.jpeg)

### 다해상도

* 피라미드 샘플링

### 모폴로지

* 모양을 분석하거나 모양을 지칭할때 사용
* 팽창, 침식, 열기 , 닫기

---

## Chapter 3

### 에지 검출

* 물체의 경계에서는 명암값이 급격한 변화가 일어난다! -> 미분으로 확인
* f의 도함수 f'에서 이진화를 거쳐 임계값을 넘으면 1로 설정. 1을 갖는 점을 에지 화소라 부른다.
* 에지를 찾는데 사용하는 마스크를 에지 마스크라한다.
* 에지의 두께 = f'가 0이 아닌 부분의 합들?
* 1차 미분에서는 봉우리를 찾고 2차 미분에서는 영교차를 찾으면 된다.
* 2차원에서는 f(x,y)에서의 미분을 생각해야 한다. y방향의 편도함수와 x방향의 편도함수를 둘다 구해야하며, 
* 이 둘은 그레디언트 벡터를 형성한다. my = [-1 0 1]^T , mx = [-1 0 1]
* 그레디언트는 벡터이므로 에지 강도와 에지 방향이 존재.
  * 에지 강도는 화소(y,x)가 에지일 가능성 또는 신뢰도, 에지 방향은 그레디언트 방향에 수직이다.

### 영교차 이론

가우시안 스무딩의 효과 

* 잡음에 대처. 2차 미분은 미분을 두 번 수행하므로 잡음 증폭이 심하다.
* 가우시안 σ(표준 편차)를 조절하여 다중 스케일 효과를 얻음. 매개변수가 커질수록 좌우로 넓게 퍼지는 봉우리 형성

### LOG 필터

* 라플라시안 = y와 x의 2차 편도함수(2차 미분)을 더함
* 라플라시안 필터 = L [0 1 0 ; 1 -4 1 ; 0 1 0]
* 입력 영상 f를 가우시안 한 후에 , 라플라시안 = 가우시안에 라플라시안을 취한 후 그 결과를 f 와 컨볼루션하는 것과 같다.

### 캐니 에지

좋은 에지 알고리즘이란? -> 최소 오류율 , 위치 정확도, 에지 두께

캐니 에지 검출 과정

1. 입력 영상 f에 σ크기의 가우시안 스무딩을 적용.
2. 결과 영상에 소벨 연산자를 적용하여 에지 강도와 에지 방향 맵을 구한다.
3. 비최대 억제를 적용하여 얇은 두께 에지 맵을 만든다.
4. 이력 임계값을 적용하여 거짓 긍정을 제거.

### 컬러에지

* RGB 영상에서 각각의 채널에서 독립적으로 에지를 검출 후, 그 결과를 하나로 합친다

### 선분 검출

에지 연결을 표현하는 법, 에지를 잘 연결할 수 있는 상황을 전제

1. 체인코드
2. 세선화 SPTA

### 허프 변환 = 전역 연산

잡음으로 인해 작은 조각으로 끊어져 있는 경우

y -x 공간을 b-a공간으로 매핑한다.

### RANSAC

인라이어와 아웃라이어가 혼합되어 있는 샘플 집합에서 인라이어를 찾아 어떤 모델을 적용시키는 일반적인 기법

---

## Chapter 4

에지는 대응점(특징점)이 될 수 없다 = 에지 방향과 에지 강도만 있기 때문에 빈약하다

지역특징 = 검출 단계와 기술 단계로 나뉨. 

특징을 어떻게 찾을것인지???

1. 모라벡 알고리즘

* 제곱차의 합 함수 -> 어떤 점이 다른 곳과 얼마나 두드러지게 다른지 측정해주는 역할
* 동서남북 네 방향으로 한 화소만큼 이동시켜 얻은 네 개의 값 즉, (S(0,1),S(0,-1),S(1,0),S(-1,0)) 에서의 최소값을 지역 특징일 가능성 값으로 간주
* 단점 - 한 화소만 이동시킴, 네 방향만 봄

2. 해리스 코너

* 제곱차의 합에서의 박스형 마스크를 가우시안 마스크로 대치함.
* A= [G* dy^2 G*dydx ; G*dydx G*dx^2] , A를 2차 모멘트 행렬이라고 불린다
  * 특징 가능성 측정.
  * 2차 모멘트 행렬로 고유값을 구하고, 두 고유값이 모두 0이거나 0에 가까우면 그곳은 변화가 거의 없다
  * 하나는 크고 하나는 작으면 한 방향으로만 변화가 있는 에지다.
  * 고유값 두 개가 모두 크면 그곳은 여러 방향으로 변화가 있는 지점이므로 그곳이 바로 특징점이다.

3. 2차 미분을 사용한 방법

* 헤시안 행렬 H = [dyy dyx ; dyx dxx]를 정의. 미분만 하면 잡음이 커지니 , 가우시안 스무딩을 수행하고 2차 미분 수행
* 헤시안에서 보통 2가지의 값을 계산한다.
  * 헤시안의 행렬식 C = det(H) = dyy(σ)dxx(σ) - dyx(σ)^2
  * 가우시안 라플라시안(LOG) = C = trace(H) = dyy(σ) + dxx(σ)

4. 슈산

* 현재 처리 중인 중심점과 인근 지역의 밝기 값이 얼마나 유사한가를 따져 보고 그 결과에 따라 특징일 가능성을 측정한다.
* 한 중심점에 원형 마스크를 씌운 뒤, 중심점과 명암값이 같은 점으로 구성된 영역을 우산이라 부른다.
* 우산의 크기비율이 50% 인곳을 에지, 50%보다 작은 곳을 코너로 검출한다. 

### 위치 찾기 알고리즘

어떤 점에대해 특징일 가능성을 측정해주는 여러가지 수식 = 모라벡, 해리스, 헤시안의 행렬값 식, LOG, 슈산. 이 수식을 영상의 모든 점에 적용하면 특징 가능성을 나타내는 새로운 영상인 특징 가능성 맵을 얻을 수 있다.

* 비최대 억제

### 스케일에 불변한 특징점 검출

#### 스케일 공간 

(y,x,t) 공간인 3차원 공간. 스케일 공간에서는 분산을 나타내는 변수 t를 스케일 매개변수라 부르며 σ^2 = t이다.

* 큰 스케일의 영상에는 큰 연산자, 작은 스케일에는 작은 연산자를 적용하여 특징을 검출하면 되지만 영상의 스케일을 알 수 없다.

첫번째 방법은 연산자를 작은 크기에서 시작하여 점점 키워가며 영상에 반복 적용하여 여러 스케일의 특징 집합을 얻는 것이다. 두번째 방법은 주어진 영상의 해상도를 점점 줄여 다중 스케일 영상을 구축하고 동일한 크기의 연산자를 여러 스케일에 적용하여 특징을 얻는 것.

* 다중 스케일 영상 구축
  * 첫번째 방식은 거리가 멀어지면 물체의 세밀한 내용은 사라지고 윤곽은 점점 흐릿해지는 원리를 이용. σ를 점점 키워가며 가우시간 마스크로 스무딩 연산을 하여 효과를 모방. 두번째는 영상의 해상도를 반씩 줄여서 피라미드 영상을 구축. 피라미드는 스케일이 두 배씩 작아지는 한계가 있다.
* σ의 값을 점점 크게 하여 얻은 일련의 영상집합을 다중 스케일 영상이라고 부른다. 

가우시안을 이용하여 다중 스케일 영상 M을 구축하였으니, 이제 지역 극점을 찾아야한다. 

(y,x,t)공간에서 극점을 찾으면 작은 물체와 큰 물체에서의 모두 특징점을 찾을 가능성을 확보한 것이다. 영상 공간에서의 위치뿐 아니라 스케일 정보도 갖는다.

#### 2.해리스 라플라스 특징 검출

극점 탐색 과정에서 2차원 영상 공간(y,x)와 스케일 t축을 구분하여 취급한다. 영상 공간에서는 해리스가 제안한 식을 사용하지만 스케일 축에서는 정규 라플라시안을 사용한다. 영상 공간에서 라플라시안은 에지에서도 반응하기 때문에 det(A) - k * trace(A)^2를 사용한다. 하지만 이 식은 스케일 축에서 지역 극점을 잘 만들지 못한다. 따라서 식을 다시 정의한다.
<img width="833" alt="스크린샷 2020-02-03 오후 8 12 53" src="https://user-images.githubusercontent.com/46750574/73655565-aa731780-46d1-11ea-8d0a-9df6368185de.png">

#### 3. SIFT 검출

Scale-Invariant Feature Transform

SIFT의 스케일 공간은 한 층이 하나의 영상이 아니라 여섯 영상의 묶음으로 구성된다. 이 영상 묶음을 옥타브라 부른다. 원래 영상에 해당하는 묶음을 옥타브 0 부터 시작. 기본 영상의 σ은 1.6으로 시작. t번째 영상을 σt로 구하였다면 σt+1 = kσt이다. 위로 올라갈수록 스케일이 커져 마스크의 크기 또한 커지고 계산 시간은 길어지낟. i번째 영상이 이미 σi로 스무딩되어 있으므로 i+1번째 영상은 기본 영상을 σi+1로 스무딩 하는대신 i번째 영상을 σi+1과 σi의 차이로 스무딩하면 시간을 크게 줄일 수 있다. 특징점을 정규 라플라시안에서 찾지 않고 DOG를 사용한다. 두 장의 스무딩된 영상의 차만 구하면 된다.

DOG완성시 3차원 공간에서 극점을 찾는 일을 시작한다. 한 옥타브에서 다섯 장의 DOG영상을 가진다. 자신이 속한 영상의 8개의 이웃과 위 , 아래에 있는 영상의 18개의 이웃에 비해 최소 또는 최대가 되면 극점, 즉 특징점으로 취한다. 이러한 특징점을 키포인트라 불렀다.

특징점 = <y,x,o,i> , o는 옥타브 번호, i는 DOG 번호.

#### 4. SURF 검출

σ 를 증가시켜 3차원 공간을 만들고 이 공간에서 지역 극점을 찾아 특징점으로 취하는 것이다. 2번 미분한 가우시안과 입력 영상을 컨볼루션. SURF는 dyy를 근사화한 연산자 Dyy를 빨리 계산하기 위해 적분 영상을 이용. 원본 영상을 그대로 둔채 연산자의 크기를 조절하여 스케일 공간을 구축. 

---

## Chapter 5

### 전통적 방법의 임계화를 이용한 영역 분할

영상 전체를 보면서 전역에 적용하는 이중 임계값 오츄 알고리즘으로는 지역적인 결과가 좋지 않을 수 있다. 지역의 상황에 따라 임계값을 적응적으로 결정하는 적응적 임계화 방법이 필요하다.

### 군집화 알고리즘 

가까이 있는 화소들을 같은 군집으로 모아준다. -> k-means 군집화 알고리즘

군집의 개수 k를 미리 알고있어야 하며, k개 군집의 중심을 초기화한다. 샘플에 각각 군집의 중심에 가까운 것을 찾아 배정한다.

-> 좋은 결과가 안나옴! 화소의 컬러값의 유사성만 고려할 뿐 두 화소의 거리는 전혀 고려하지 않는다

### 분할합병

정교한 규칙이 있다면 좋은 성능을 보인다. 하지만 자연영상, 명암 또는 컬러영상인 경우 하나의 규칙을 만드는일은 불가능하다.

### 그래프 방법

그래프 분할 문제를 전역 최적화 문제로 전개했을 때, 두 가지 사항을 설계해야 한다.

* 어떤 분할의 좋은 정도를 측정하는 목적 함수
* 목적 함수를 최대화 또는 최소화하는 최적해를 찾는 효율적인 탐색 알고리즘

1. 최소 신장트리

최소 신장을 구해줌, 연결요소 C가 얼마나 균일한지 측정하는 식 intra(C)를 정의. intra는 최소 신장트리의 에지 중 가장 큰 가중치. 같은 영역일 가능성이 어떤 요소 두개만 볼때보다 intra로 확인하면 더 오류가 없다.

연결요소가 두개 일때, mult_intra(.)는 두 연결요소가 얼마나 균일한지 측정한다. 

<img width="803" alt="스크린샷 2020-02-03 오후 8 47 52" src="https://user-images.githubusercontent.com/46750574/73655571-aba44480-46d1-11ea-97ed-d682b99e8c82.png">
2. 정규화 절단

Wu의 방법

* Cut함수 - 분할이 얼마나 좋은지 측정해주는 목적 함수. 연결요소의 크기가 클수록 둘 사이의 에지가 많아져 성능이 떨어진다.

Shi의 방법

* Cut함수를 정규화. 분할선이 여러개가 생겨서 근사해를 표준 고유값 식으로 바꾸어 쓴다.

### 민시프트

1. 군집화
   * n개의 d차원 점으로 구성. X를 생성한 원래 확률밀도함수 p(.)를 추정. 
   * 가장 확률이 높은곳이 봉우리이다.
   * 샘플 집합을 근사하는 함수를 구하는 방법 중에 가장 대표적인 것은 파젠창. -> 어떤 점 x에 커널 k(.)를 씌우고 커널속에 들어오는 샘플의 가중치 합을 계산하여 x에서의 함수값 p(x)를 추정하는 방법. 커널은 보통 평편한 함수 또는 가우시안을 사용

<img width="587" alt="스크린샷 2020-02-03 오후 9 00 30" src="https://user-images.githubusercontent.com/46750574/73655566-ab0bae00-46d1-11ea-9f63-1edddcc2a73c.png">
민시프트를 통해 탐색 문제를 푸는 알고리즘.

* 첫 단계에서 샘플 점 각각에 대해 모드를 찾는다. 
* 샘플을 시작점으로 삼아 모드 탐색을 시작. 수렴 조건이 만족될 때까지 반복. 반복 도중 현재 점과 그 다음 점이 아주 가까우면 수렴했다고 판단. 찾은 수렴 점들은 봉우리로 밀집된다.
* 민시프트는 다른 매개변수없이 커널의 폭을 뜻하는 h 하나뿐이다.

### 영상 분할과 스무딩

멀리 떨어진 화소가 같은 컬러값을 같는 경우, 이들은 같은 모드로 수렴하여 동일한 군집에 속하기 때문에 k-means과 같은 알고리즘은 문제가 생긴다. 민시프트는 이런 문제를 해결하기 위해 컬러 정보뿐 아니라 화소간의 근접성을 같이 이용한다. 화소의 컬러에 해당하는 3차원 (r,g,b)와 화소의 위치를 나타내는 2차원(y,x)를 결합하여 5차원 공간으로 매핑한다. Ex) (y,x)=(20,12), (r,g,b) = (102,50,25) 라면 (y,x,r,g,b)=(20,12,102,50,25)의 5차원 벡터로 표현. 공간은 2차원 컬러는 3차원이기 때문에 다른 커널 함수의 곱을 사용해야함.

### 워터셰드

영상f 에 그래디언트 연산을 적용하여 에지 강도 맵을 구하고 최저 영역을 찾아 각각에 서로 다른 번호를 매긴다. 번호가 매겨진 영역에 이웃 화소를 에지 강도에 따라 우선순위 큐에 삽입. 큐로 번호 부여하면서 워터셰드로 취한다. 

### 대화식 물체 분할

관심 있는 물체를 오려내는 작업 - 매팅

1. 능동 외곽선

* 스네이크 알고리즘 - 물체의 외곽선에 해당하는 곡선을 능동적으로 찾아줌. 

<img width="963" alt="스크린샷 2020-02-03 오후 9 14 36" src="https://user-images.githubusercontent.com/46750574/73655569-ab0bae00-46d1-11ea-9f69-4da9cf5a10ad.png">
최소가 되는 곡선을 찾는게 궁극적으로 풀어야하는 문제

2. 그래프 절단
<img width="839" alt="스크린샷 2020-02-03 오후 9 16 56" src="https://user-images.githubusercontent.com/46750574/73655570-aba44480-46d1-11ea-92a5-d0e694d97356.png">
---

## Chapter 6

추출한 정보 또는 정보를 추출해 주는 알고리즘을 기술자 라고 한다. 기술자는 일정한 크기의 벡터로 표현하기 때문에 특징 벡터라고 부르기도 한다. 특징은 관심점이나 영역을 지칭하는데 사용하지만, 기술자를 구성하는 요소 하나하나를 지칭하기도 한다.

### 1. SIFT 기술자



### 2. SIFT 변형

* PCA-SIFT
* GLOH
* 모양 컨텍스트



### 3. 이진 기술자

* 특징점 주변에 있는 두 개의 화소를 비교 쌍으로 삼아, 그들의 명암값을 비교하여 0 또는 1의 이진값을 생성한다.
* 대표적인 세 가지 이진 기술자가 사용하는 조사 패턴은. BRIEF, ORB, BRISK 등이 있다. 대신 기술만 가능하고 검출은 불가능하기 때문에 검출자를 같이 써야함



### 영역 기술자

#### 모멘트(화소 전체)

* 화소 또는 화소의 명암값을 통계적 분포를 측정하고 그로부터 유용한 정보를 추출함.
* 영역 R의 면적과 중점을 구함.

#### 모양(다양한 관점)

* 면적과 둘레를 구함
* 체인코드를 사용하여 구함
* 투영과 프로파일
  * 투영 - 행, 열 i또는 j에 있는 1의 개수, 가로, 세로 방향으로 투영하여 기술자를 얻는다 (개수 중심)
  * 프로파일 - 바깥에서 영역을 바라보는 값을 측정, 상하좌우 네 가지. 위 에서 열 i 를 바라보았을때 처음 1까지의 거리 (거리 중심)

#### 푸리에 기술자(주파수 공간에서 기술자 추출)

* 기저 함수와 선형결합에서의 기저 함수의 계수를 찾는 변환.
* 이산 푸리에 변환은 이산 신호로부터 계수를 구해준다.

<img width="679" alt="스크린샷 2020-02-03 오후 9 40 44" src="https://user-images.githubusercontent.com/46750574/73655568-ab0bae00-46d1-11ea-9c1f-28627bc56bb7.png">

영역으로부터 특징을 추출할 때,

* 영역의 경계 표현
* 경계를 복소수로 표현하여 2차원 점을 1차원으로 바꿔 1차원 푸리에 변환 사용

### 텍스처

에지는 텍스처를 나타내는 좋은 정보 중의 하나. 다른 그림에서 에지는 밀집도와 방향에서 서로 다른 양상을 보일 것이다.

1. #### 전역기술자

명암 히스토그램을 사용하여 추출하는 식은 텍스처를 구분하는데 분별력이 떨어진다. 

<img width="955" alt="스크린샷 2020-02-03 오후 9 43 20" src="https://user-images.githubusercontent.com/46750574/73655573-aba44480-46d1-11ea-9397-36b825998aeb.png">

* mag(i) = 에지 화소의 에지 강도를 q단계로 양자화 하여 구한 히스토그램
* dir(i) = 8 -방향으로 양자화된 에지 방향 히스토그램
* smooth = 영역의 부드러운 정도
* skew = 밝은 쪽과 어두운 쪽 중 어느 쪽에 치우쳤는지 
* uniform은 영역이 얼마나 균일한지 측정
* entropy는 반대로 영역의 변화가 얼마나 심한지

2. #### 지역 관계 기술자

동시발행 행렬

두 화소의 이웃관계를 규정. 명암 영상은 대부분 L=256이기 때문에 256x256의 큰 행렬이 만들어지는데, 보통 L단계를 q단계로 양자화하여 사용.

<img width="694" alt="스크린샷 2020-02-03 오후 9 48 13" src="https://user-images.githubusercontent.com/46750574/73655563-aa731780-46d1-11ea-9fa2-b56fb92114f9.png">

지역 이진 패턴

* LBP = 3x3 윈도우를 씌우고 주변화소를 중심과 비교하여 크면 1 작으면 0 , 그리고 8비트 2진수로 변환
*  LTP = LBP 를 두개 결합



### 주성분 분석 PCA

정보 손실을 최소화. 원래 공간에 퍼져 있는 정도가 변환된 공간에서도 얼마나 잘 유지하는지를 성능 평가 척도로 삼는다. 이 척도는 샘플들의 분산으로 측정한다.

목표 = 변환된 샘플들의 분산을 최대화하는 단위 벡터 u 를 찾아야함.

* 공분산 행렬의 고유값이 제일 큰 값을 찾는다. 
* 공분산 행렬의 고유벡터를 계산하면 그 값이 최대 분산을 갖는 u가 된다.